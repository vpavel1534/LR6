# Лабораторная работа №6  
## Моделирование Kill-chain процедур

**Дисциплина:** Защита программного обеспечения защищенных автоматизированных систем  
**Выполнил:** Воробьев Павел  


---

## Теоретическая часть

### Определение модели Kill Chain
Модель **Cyber Kill Chain** (Цепочка уничтожения) — это структурированная последовательная модель, описывающая этапы типичной кибератаки от начальной подготовки до достижения конечной цели злоумышленника. Основная идея заключается в том, что сложная атака состоит из цепочки шагов, и разрыв этой цепочки на любом из этапов (посредством обнаружения или предотвращения) может остановить атаку или значительно увеличить её стоимость для атакующего.

### Семь этапов классической модели Cyber Kill Chain
1. **Разведка (Reconnaissance)** — сбор информации о цели.  
2. **Создание оружия (Weaponization)** — подготовка вредоносного инструмента (payload).  
3. **Доставка (Delivery)** — передача payload цели.  
4. **Эксплуатация (Exploitation)** — выполнение вредоносного кода через уязвимость.  
5. **Установка (Installation)** — закрепление присутствия в системе (persistence).  
6. **Установление командования и управления (Command & Control, C2)** — создание канала связи с compromised-системой.  
7. **Действия по достижению цели (Actions on Objectives)** — выполнение основной задачи атаки.


---

## Практическая часть (Вариант 2)

**Используемый C2-фреймворк:** AdaptixC2  
**Атакующая машина:** Linux Mint (IP: 192.168.0.183)  
**Целевая машина:** Windows 10 (IP: 192.168.0.165), Windows Defender отключён для наглядности  
**Сеть:** Локальная виртуальная сеть (VirtualBox)  
**Вектор доставки:** Имитация watering hole — через веб-сервер Apache с маскировкой под обычный HTTP-трафик  

### Этап 1: Разведка (Reconnaissance)

**Цель этапа:** Сбор информации о цели для выбора вектора атаки.

**Действия:**  
В роли атакующего я провёл активную разведку целевой Windows-машины с IP-адресом 192.168.0.165 с помощью утилиты nmap, запущенной на виртуальной машине Linux Mint.

 <img width="974" height="312" alt="image" src="https://github.com/user-attachments/assets/765cd18f-6804-41fb-839f-a90029c289f4" />


Открытые порты 135, 139, 445 и 5357 указывают на то, что на целевой машине включены типичные службы Windows:

- RPC (135) — Remote Procedure Call,
  
- NetBIOS (139) и SMB (445) — файловый и принтерный обмен, аутентификация,
  
- HTTPAPI (5357) — используется для SSDP/UPnP (часто встречается в Windows 7/10/11).

Эти службы часто становятся целью атак (например, EternalBlue/MS17-010 для SMB, атаки на RPC, перебор паролей и т.д.).


### Этап 2: Создание оружия (Weaponization)

**Цель этапа**: Подготовка вредоносной полезной нагрузки.

**Действия**: В клиенте AdaptixC2 создан listener (TCP/HTTP) с маскировкой (User-Agent Firefox, баннер сервера). Сгенерирован beacon-агент в формате .exe для Windows x64, привязанный к listener.

<img width="624" height="644" alt="image" src="https://github.com/user-attachments/assets/1abd5361-44f7-4786-ba5a-10b2a66d4f82" />

<img width="543" height="466" alt="image" src="https://github.com/user-attachments/assets/c9de3cd1-b903-400c-b93f-a9631de880c9" />

### Этап 3: Доставка (Delivery)

**Цель этапа**: Передача payload на целевую систему.

**Действия**: Развёрнут веб-сервер Apache на атакующей машине (IP 192.168.0.183). Сгенерированный .exe размещён на сервере и доступен для скачивания по HTTP. Доставка имитирована загрузкой файла на целевую ВМ.

<img width="974" height="269" alt="image" src="https://github.com/user-attachments/assets/09f6223f-ba06-41a9-961f-36e942daefec" />

### Этап 4: Эксплуатация (Exploitation)

**Цель этапа**: Запуск кода payload (в данном случае — социальная инженерия, запуск .exe жертвой).

<img width="974" height="137" alt="image" src="https://github.com/user-attachments/assets/48276007-81e8-4a11-9d74-7592d5810efc" />




### Этап 6: Установление командования и управления (Command & Control, C2)

**Цель этапа**: Обеспечение устойчивого канала связи. Критически важен, так как без него злоумышленник теряет контроль и не может выдавать команды/экфильтровать данные.

**Результат**: Агент успешно подключается к team server. В интерфейсе клиента появляется активный агент, возможен обмен командами.

<img width="974" height="280" alt="image" src="https://github.com/user-attachments/assets/344ec53a-1e36-455e-852e-d3a0483f12d7" />


### Этап 7: Действия по достижению цели (Actions on Objectives)

**Цель этапа**: Выполнение задачи атаки (получение удаленного управления на машиной, кража данных, разведка).

**Действия** : Через агент выполнена команда обследования файловой системы: просмотр дерева каталогов (C:, Users, Desktop и т.д.). Данные переданы оператору.

<img width="974" height="735" alt="image" src="https://github.com/user-attachments/assets/1a02b686-cecb-4f31-a935-b55086bf4af8" />


Файл, содержащий конфиденциальные данные, **Николай Погосян.txt** был похищен на атакующую машину. А также были проверены другие возможности фреймворка: удаленный запуск инсталлятора firefox на атакуемой машине.

<img width="974" height="590" alt="image" src="https://github.com/user-attachments/assets/6b1b5278-f5f0-43cb-b252-9d096ddb7c3d" />


Окно "Execute binary" — это команда из C2-фреймворка, которая позволяет оператору (атакующему) удалённо запустить любой исполняемый файл (.exe) на скомпрометированной машине.

<img width="709" height="184" alt="image" src="https://github.com/user-attachments/assets/14de7981-2a6e-48f4-b22f-131c49e9ccdb" />

Результат удаленного запуска исполняемого файла

<img width="734" height="365" alt="image" src="https://github.com/user-attachments/assets/463e1f0f-efa4-4437-844f-833f34dacd78" />

### Ответы на вопросы



1. Дайте определение модели Kill Chain (Цепочки уничтожения) в контексте кибербезопасности.

Это модель, описывающая этапы кибератаки от начала до конца


2. Кто и с какой целью разработал классическую модель Cyber Kill Chain?
3. 
Изначально концепция была военной, но ее адаптировали для киберпространства компанией Lockheed Martin

5. Перечислите все семь этапов классической модели Cyber Kill Chain по порядку.

Разведка, создание оружия, Доставка, Эксплуатация, Установка, Установление командования и управления, Действия по достижению цели

4. Какова основная оборонительная идея модели Kill Chain?

Для каждого этапа Kill Chain можно разработать контрмеры

5. На каком этапе Kill Chain происходит отправка фишингового письма?

Доставка

6. Что такое этап "Установление командования и управления" (C2)? Почему он критически важен для злоумышленника?

Обеспечение связи с системой. Именно на этом этапе происходит командование ОС.

7. Приведите пример контрмеры на этапе "Доставка".

Встроенная в браузер функция, блокирующая сразу переход на сайт с незащищённым протоколом HTTP

8. Опишите сценарий атаки с использованием ransomware (шифровальщика) через призму этапов Kill Chain.

Злоумышленники проводят разведку, создают и упаковывают шифровальщик в легитимный файл, доставляют его через фишинговое письмо, эксплуатируют уязвимость для запуска, устанавливают вредоносное ПО в системе, устанавливают канал C2 для получения ключа шифрования и, наконец, выполняют шифрование файлов и вывод требований о выкупе.

9. Почему этапы "Доставка" и "Эксплуатация" считаются одними из самых эффективных для обороны?

Это наиболее безопасные этапы в случае, если они провалились. В случае "доставки" файл можно удалить, а в случае эксплуатации файл может быть заблокирован дополнительными мерами. Скрыть трафик полностью невозможно, а уже запущенный процесс можно и не найти как в примере из ЛР.

10. В чем заключаются основные ограничения и недостатки классической модели Cyber Kill Chain?

Линейность, плохо описывает инсайдерские угрозы, слабо освещает перемещение злоумышленника по сети, одна Kill Chain может быть лишь маленькой частью большой кампании.

11. Объясните, как модель Kill Chain используется при расследовании киберинцидентов.

Kill Chain используется как структурная карта для реконструкции атак

12. В чем разница между этапами "Эксплуатация" и "Установка"?

На этапе "Установка" KC не эксплуатирует, а на "Эксплуатация" установка уже прошла. Одно следствие из другого.

13. Сравните этап "Разведка" в Kill Chain и тактику "Сбор информации" в модели MITRE ATT&CK. Что общего и в чем различие?

"Разведка" имеется в виду про разведку сети и устройства, а сбор данных происходит уже с заражённого устройства

14. Как концепция "Обороны в глубину" (Defense in Depth) связана с моделью Kill Chain?

Она реализует принцип эшелонированной защиты, выстраивая специфические контрмеры для каждого этапа Kill Chain


